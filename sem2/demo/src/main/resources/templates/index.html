<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/thymeleaf-extras-springsecurity6">
<head>
    <meta charset="UTF-8">
    <title>–°–∏—Å—Ç–µ–º–∞ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è –æ—Ç–µ–ª—è</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background-color: #f0f0f0;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            display: flex;
            gap: 20px;
        }
        .left-panel {
            flex: 1;
            background: white;
            padding: 15px;
            border-radius: 5px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        .right-panel {
            flex: 2;
            background: white;
            padding: 15px;
            border-radius: 5px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        .section {
            margin-bottom: 30px;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 3px;
        }
        .room-card {
            border: 1px solid #ccc;
            padding: 10px;
            margin: 10px 0;
            background: #f9f9f9;
        }
        input, select, textarea {
            width: 100%;
            padding: 5px;
            margin: 5px 0;
            box-sizing: border-box;
        }
        button {
            background: #007bff;
            color: white;
            padding: 8px 15px;
            border: none;
            border-radius: 3px;
            cursor: pointer;
            margin: 5px 0;
        }
        button:hover {
            background: #0056b3;
        }
        .btn-add {
            background: #28a745;
        }
        .btn-add:hover {
            background: #218838;
        }
        .btn-danger {
            background: #dc3545;
        }
        .btn-danger:hover {
            background: #c82333;
        }
        .header {
            background: #2c3e50;
            color: white;
            padding: 10px 15px;
            margin-bottom: 20px;
            border-radius: 5px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .user-info {
            color: #ecf0f1;
        }
        h2, h3 {
            color: #2c3e50;
            margin-top: 0;
        }
        .message {
            padding: 10px;
            margin: 10px 0;
            border-radius: 3px;
        }
        .success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        .error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        .test-users {
            background: #e9ecef;
            padding: 10px;
            border-radius: 3px;
            font-size: 12px;
            margin-top: 10px;
        }
        .booking-form {
            background: #e8f4fd;
            padding: 10px;
            margin-top: 10px;
            border: 1px solid #b6d4fe;
        }
    </style>
</head>
<body>
    <!-- –®–∞–ø–∫–∞ -->
    <div class="header">
        <h1>üè® –°–∏—Å—Ç–µ–º–∞ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è –æ—Ç–µ–ª—è</h1>
        <div class="user-info">
            <div sec:authorize="!isAuthenticated()">
                <a href="/login" style="color: white; margin-right: 10px;">–í—Ö–æ–¥</a>
            </div>
            <div sec:authorize="isAuthenticated()">
                <span>–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: <span sec:authentication="name"></span></span>
                <form th:action="@{/logout}" method="post" style="display:inline; margin-left: 10px;">
                    <button type="submit" style="padding: 3px 8px; font-size: 12px;">–í—ã—Ö–æ–¥</button>
                </form>
            </div>
        </div>
    </div>

    <!-- –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä -->
    <div class="container">
        <!-- –õ–µ–≤—ã–π –±–ª–æ–∫: –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–æ–º–Ω–∞—Ç–∞–º–∏ -->
        <div class="left-panel">
            <h2>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–æ–º–Ω–∞—Ç–∞–º–∏</h2>
            
            <!-- –§–æ—Ä–º–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –∫–æ–º–Ω–∞—Ç—ã -->
            <div sec:authorize="hasRole('MODERATOR') or hasRole('ADMIN')" class="section">
                <h3>–î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—É—é –∫–æ–º–Ω–∞—Ç—É</h3>
                
                <form th:action="@{/rooms/create}" method="post">
                    <input type="text" name="number" placeholder="–ù–æ–º–µ—Ä –∫–æ–º–Ω–∞—Ç—ã (–Ω–∞–ø—Ä–∏–º–µ—Ä: 23)" required>
                    
                    <select name="type" required>
                        <option value="">–í—ã–±–µ—Ä–∏—Ç–µ —Ç–∏–ø</option>
                        <option value="STANDARD">–°—Ç–∞–Ω–¥–∞—Ä—Ç</option>
                        <option value="VIP">VIP</option>
                        <option value="DELUXE">–î–µ–ª—é–∫—Å</option>
                        <option value="SUITE">–õ—é–∫—Å</option>
                    </select>
                    
                    <textarea name="description" placeholder="–û–ø–∏—Å–∞–Ω–∏–µ" rows="2"></textarea>
                    
                    <input type="number" name="price" placeholder="–¶–µ–Ω–∞ (—Ä—É–±.)" step="0.01" required>
                    
                    <input type="number" name="capacity" placeholder="–í–º–µ—Å—Ç–∏–º–æ—Å—Ç—å (—á–µ–ª.)" required>
                    
                    <label style="display: block; margin: 5px 0;">
                        <input type="checkbox" name="available" checked> –î–æ—Å—Ç—É–ø–Ω–∞ –¥–ª—è –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è
                    </label>
                    
                    <button type="submit" class="btn-add">+ –î–æ–±–∞–≤–∏—Ç—å –∫–æ–º–Ω–∞—Ç—É</button>
                </form>
            </div>

            <!-- –¢–µ—Å—Ç–æ–≤—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ -->
            <div class="test-users">
                <strong>–¢–µ—Å—Ç–æ–≤—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏:</strong><br>
                ‚Ä¢ user / 1234 (–æ–±—ã—á–Ω—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å)<br>
                ‚Ä¢ moderator / 1234 (–º–æ–¥–µ—Ä–∞—Ç–æ—Ä)<br>
                ‚Ä¢ admin / 1234 (–∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä)
            </div>

            <!-- –ú–æ–∏ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è -->
            <div sec:authorize="isAuthenticated()" class="section">
                <h3>–ú–æ–∏ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è</h3>
                <a href="/booking/my" style="color: #007bff; text-decoration: none;">‚Üí –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –≤—Å–µ –º–æ–∏ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è</a>
            </div>

            <!-- –î–ª—è –≥–æ—Å—Ç–µ–π -->
            <div sec:authorize="!isAuthenticated()" class="section">
                <h3>–î–ª—è –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è</h3>
                <p>–í–æ–π–¥–∏—Ç–µ –≤ —Å–∏—Å—Ç–µ–º—É, —á—Ç–æ–±—ã –±—Ä–æ–Ω–∏—Ä–æ–≤–∞—Ç—å –∫–æ–º–Ω–∞—Ç—ã</p>
                <a href="/login" style="color: #007bff; text-decoration: none;">‚Üí –í–æ–π—Ç–∏ –≤ —Å–∏—Å—Ç–µ–º—É</a>
            </div>
        </div>

        <!-- –ü—Ä–∞–≤—ã–π –±–ª–æ–∫: –°–ø–∏—Å–æ–∫ –∫–æ–º–Ω–∞—Ç –¥–ª—è –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è -->
        <div class="right-panel">
            <h2>–î–æ—Å—Ç—É–ø–Ω—ã–µ –¥–ª—è –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è –∫–æ–º–Ω–∞—Ç—ã</h2>
            
            <!-- –°–æ–æ–±—â–µ–Ω–∏—è -->
            <div th:if="${success}" class="message success">
                [[${success}]]
            </div>
            <div th:if="${error}" class="message error">
                [[${error}]]
            </div>
            
            <!-- –°–ø–∏—Å–æ–∫ –∫–æ–º–Ω–∞—Ç -->
            <div th:if="${rooms != null and !rooms.empty}">
                <div th:each="room : ${rooms}">
                    <div class="room-card">
                        <h3>–ö–æ–º–Ω–∞—Ç–∞ ‚Ññ[[${room.number}]] ([[${room.type}]])</h3>
                        <p><strong>–í–º–µ—Å—Ç–∏–º–æ—Å—Ç—å:</strong> [[${room.capacity}]] —á–µ–ª.</p>
                        <p><strong>–¶–µ–Ω–∞:</strong> [[${room.price}]] —Ä—É–±./–Ω–æ—á—å</p>
                        <p>[[${room.description}]]</p>
                        
                        <!-- –§–æ—Ä–º–∞ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è -->
                        <div sec:authorize="isAuthenticated()" class="booking-form">
                            <h4>–ó–∞–±—Ä–æ–Ω–∏—Ä–æ–≤–∞—Ç—å —ç—Ç—É –∫–æ–º–Ω–∞—Ç—É:</h4>
                            <form th:action="@{/booking/create}" method="post">
                                <input type="hidden" name="roomId" th:value="${room.id}">
                                
                                <div style="display: flex; gap: 10px; margin-bottom: 10px;">
                                    <div style="flex: 1;">
                                        <label style="font-size: 12px;">–î–∞—Ç–∞ –∑–∞–µ–∑–¥–∞:</label>
                                        <input type="date" name="checkIn" required id="checkIn_[[${room.id}]]">
                                    </div>
                                    <div style="flex: 1;">
                                        <label style="font-size: 12px;">–î–∞—Ç–∞ –≤—ã–µ–∑–¥–∞:</label>
                                        <input type="date" name="checkOut" required id="checkOut_[[${room.id}]]">
                                    </div>
                                </div>
                                
                                <input type="text" name="guestName" placeholder="–í–∞—à–µ –∏–º—è" required>
                                <input type="email" name="guestEmail" placeholder="Email" required>
                                <textarea name="specialRequests" placeholder="–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø–æ–∂–µ–ª–∞–Ω–∏—è" rows="2"></textarea>
                                
                                <button type="submit">–ó–∞–±—Ä–æ–Ω–∏—Ä–æ–≤–∞—Ç—å</button>
                            </form>
                        </div>
                        
                        <!-- –î–ª—è –Ω–µ–∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã—Ö -->
                        <div sec:authorize="!isAuthenticated()">
                            <p style="color: #666; font-style: italic;">–î–ª—è –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è –≤–æ–π–¥–∏—Ç–µ –≤ —Å–∏—Å—Ç–µ–º—É</p>
                        </div>
                        
                        <!-- –ö–Ω–æ–ø–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è (—Ç–æ–ª—å–∫–æ –¥–ª—è –∞–¥–º–∏–Ω–æ–≤) -->
                        <div sec:authorize="hasRole('ADMIN')" style="margin-top: 10px;">
                            <form th:action="@{'/rooms/delete/' + ${room.id}}" method="post" 
                                  th:attr="onsubmit='return confirm(\'–£–¥–∞–ª–∏—Ç—å –∫–æ–º–Ω–∞—Ç—É ‚Ññ' + ${room.number} + '?\')'">
                                <button type="submit" class="btn-danger" style="padding: 3px 8px; font-size: 12px;">–£–¥–∞–ª–∏—Ç—å –∫–æ–º–Ω–∞—Ç—É</button>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- –ï—Å–ª–∏ –∫–æ–º–Ω–∞—Ç –Ω–µ—Ç -->
            <div th:if="${rooms == null or rooms.empty}">
                <p style="color: #666; font-style: italic;">–ù–µ—Ç –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –∫–æ–º–Ω–∞—Ç –¥–ª—è –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è.</p>
                <div sec:authorize="hasRole('MODERATOR') or hasRole('ADMIN')">
                    <p>–î–æ–±–∞–≤—å—Ç–µ –ø–µ—Ä–≤—É—é –∫–æ–º–Ω–∞—Ç—É –≤ –ª–µ–≤–æ–π –ø–∞–Ω–µ–ª–∏.</p>
                </div>
            </div>
        </div>
    </div>

    <script>
        // –ê–≤—Ç–æ–∑–∞–ø–æ–ª–Ω–µ–Ω–∏–µ –¥–∞—Ç
        document.addEventListener('DOMContentLoaded', function() {
            // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –º–∏–Ω–∏–º–∞–ª—å–Ω—É—é –¥–∞—Ç—É –∑–∞–µ–∑–¥–∞ - –∑–∞–≤—Ç—Ä–∞
            const tomorrow = new Date();
            tomorrow.setDate(tomorrow.getDate() + 1);
            const minDate = tomorrow.toISOString().split('T')[0];
            
            // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –º–∏–Ω–∏–º–∞–ª—å–Ω—É—é –¥–∞—Ç—É –≤—ã–µ–∑–¥–∞ - –ø–æ—Å–ª–µ–∑–∞–≤—Ç—Ä–∞
            const dayAfterTomorrow = new Date();
            dayAfterTomorrow.setDate(dayAfterTomorrow.getDate() + 2);
            const minOutDate = dayAfterTomorrow.toISOString().split('T')[0];
            
            // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∑–Ω–∞—á–µ–Ω–∏—è –¥–ª—è –≤—Å–µ—Ö –ø–æ–ª–µ–π –¥–∞—Ç—ã
            const checkInInputs = document.querySelectorAll('input[name="checkIn"]');
            const checkOutInputs = document.querySelectorAll('input[name="checkOut"]');
            
            checkInInputs.forEach(input => {
                input.min = minDate;
                input.value = minDate; // —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∑–∞–≤—Ç—Ä–∞ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
            });
            
            checkOutInputs.forEach(input => {
                input.min = minOutDate;
                input.value = minOutDate; // —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –ø–æ—Å–ª–µ–∑–∞–≤—Ç—Ä–∞ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
            });
            
            // –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏–µ –¥–≤–æ–π–Ω–æ–π –æ—Ç–ø—Ä–∞–≤–∫–∏ —Ñ–æ—Ä–º
            const forms = document.querySelectorAll('form');
            forms.forEach(form => {
                form.addEventListener('submit', function() {
                    const submitBtn = this.querySelector('button[type="submit"]');
                    if (submitBtn) {
                        submitBtn.disabled = true;
                        submitBtn.textContent = '–û–±—Ä–∞–±–æ—Ç–∫–∞...';
                    }
                });
            });
        });
    </script>
</body>
</html>